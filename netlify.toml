[build]
publish = "."
functions = "netlify/functions"
command = """
set -e
mkdir -p vendor
echo 'Downloading Auth0 SPA SDK locallyâ€¦'
curl -fsSL https://unpkg.com/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.js \
  -o vendor/auth0-spa-js.production.js
curl -fsSL https://unpkg.com/@auth0/auth0-spa-js@2.1.3/dist/auth0-spa-js.production.esm.js \
  -o vendor/auth0-spa-js.production.esm.js
"""

# âœ… Lascia passare il callback di Auth0 (nessun guard)
[[edge_functions]]
path = "/callback"
function = "noop"

# ðŸ”’ Proteggi TUTTE le Netlify Functions (richiede id_token)
[[edge_functions]]
path = "/.netlify/functions/*"
function = "protect"

# ðŸ”’ (Opzionale) proteggi la cartella /private/*
[[edge_functions]]
path = "/private/*"
function = "protect"

# SPA fallback (tienilo per ultimo)
[[redirects]]
from = "/*"
to = "/index.html"
status = 200